/*
 Hype Video Controller v1.1.0
 Copyright (2025) Max Ziebell. MIT-license
*/
'use strict';"HypeVideoController"in window===!1&&(window.HypeVideoController=function(){function p(a){a.querySelectorAll("video").forEach(c=>{c.pause();c.currentTime=0})}function q(a){if(g.autoObserver){var c=document.getElementById(a.documentId()),d=new MutationObserver(e=>{e.forEach(f=>{f.type==="attributes"&&f.attributeName==="style"&&f.target.classList.contains("HYPE_scene")&&(f=f.target,window.getComputedStyle(f).display==="none"&&p(f))})});c=c.getElementsByClassName("HYPE_scene");var b={attributes:!0,
attributeFilter:["style"]};Array.from(c).forEach(e=>{d.observe(e,b)});r.set(a,d)}}function h(a,c,d){var b=(b=d.closest(".HYPE_scene"))?window.getComputedStyle(b).display!=="none":!1;b&&(a.triggerCustomBehaviorNamed(c),(d=d.getAttribute("data-video-name"))&&a.triggerCustomBehaviorNamed(`${c} ${d}`),window.HypeReactiveContent&&a.refreshReactiveContentDebounced())}function t(a,c){l(a);let d=a.currentTime;var b=k(a,"stallTimeout");b=setTimeout(()=>{a.paused||a.currentTime!==d||(console.warn("Video playback stalled."),
h(c,"Video Stalled",a),k(a,"endOnStall")&&(console.log('"endOnStall" is true. Triggering "Video Ended" as a fallback.'),a.pause(),h(c,"Video Ended",a)))},b);m.set(a,b)}function l(a){m.has(a)&&(clearTimeout(m.get(a)),m.delete(a))}function u(a){a.getElementById(a.currentSceneId()).querySelectorAll("video").forEach(c=>{n.has(c)||(c.addEventListener("ended",()=>{l(c);h(a,"Video Ended",c)}),c.addEventListener("playing",()=>{l(c);c.paused||c.ended||c.hasAttribute("data-autoplay-failed")||h(a,"Video Started",
c);c.removeAttribute("data-autoplay-failed")}),c.addEventListener("pause",()=>{l(c);h(a,"Video Paused",c)}),c.addEventListener("waiting",()=>{t(c,a)}),n.add(c))})}function k(a,c){var d={endOnStall:"end-on-stall",endOnAutoplayFail:"end-on-autoplay-fail",stallTimeout:"stall-timeout",autoPlaysInline:"plays-inline",autoMute:"auto-mute",autoPlay:"auto-play"}[c]||c.toLowerCase();const b=c.toLowerCase();d=a.getAttribute(`data-video-${d}`);d===null&&(d=a.getAttribute(`data-video-${b}`));if(d!==null){if(typeof g[c]===
"boolean")return d==="true";if(typeof g[c]==="number"&&(a=parseInt(d,10),!isNaN(a)))return a}return g[c]}function v(a){a.getElementById(a.currentSceneId()).querySelectorAll("video").forEach(c=>{k(c,"autoMute")&&(c.muted=!0);k(c,"autoPlaysInline")&&(c.playsInline=!0);requestAnimationFrame(()=>{if(k(c,"autoPlay")){c.removeAttribute("autoplay");c.autoplay=!1;c.currentTime=0;const d=c.play();d!==void 0&&d.catch(b=>{console.warn(`Autoplay failed for video: ${c.id||"unnamed"}`,b);c.setAttribute("data-autoplay-failed",
"true");h(a,"Video Autoplay Failed",c);k(c,"endOnAutoplayFail")&&(console.log('Triggering "Video Ended" due to autoplay failure.'),setTimeout(()=>{h(a,"Video Ended",c)},0))})}})})}function w(a,c){(a=a.getElementById(a.currentSceneId()))&&a.querySelectorAll("video").forEach(d=>{d.pause();c&&(d.currentTime=0);d.removeAttribute("data-autoplay-failed")})}const n=new WeakSet,r=new WeakMap,m=new WeakMap,g={autoPlay:!0,autoMute:!0,autoPlaysInline:!0,autoObserver:!0,endOnStall:!0,stallTimeout:2E3,endOnAutoplayFail:!0};
"HYPE_eventListeners"in window===!1&&(window.HYPE_eventListeners=[]);window.HYPE_eventListeners.push({type:"HypeDocumentLoad",callback:function(a,c,d){q(a);a.getVideo=function(b){const e=this.getElementById(this.currentSceneId());return b?b.match(/^[.#\[]/)||b.includes(" ")?e.querySelector(b):e.querySelector(`video[data-video-name="${b}"]`):e.querySelector("video")};a.isVideoPlaying=function(b){return(b=this.getVideo(b))?!b.paused&&!b.ended:!1};a.playVideo=function(b){const e=this.getVideo(b);e&&
e.play().catch(f=>{console.warn(`Failed to play video "${b}":`,f)})};a.pauseVideo=function(b){(b=this.getVideo(b))&&b.pause()};a.stopVideo=function(b){if(b=this.getVideo(b))b.pause(),b.currentTime=0};a.setVideoVolume=function(b,e){(b=this.getVideo(b))&&e>=0&&e<=1&&(b.volume=e)};a.seekVideoTo=function(b,e){(b=this.getVideo(b))&&e>=0&&e<=b.duration&&(b.currentTime=e)};a.toggleVideoMute=function(b){if(b=this.getVideo(b))b.muted=!b.muted};a.getVideoDuration=function(b){return(b=this.getVideo(b))?b.duration:
null};a.seekVideoToPercentage=function(b,e){return(b=this.getVideo(b))&&e>=0&&e<=100?(e=e/100*b.duration,b.currentTime=e):null};a.muteAllVideos=function(){this.getElementById(this.currentSceneId()).querySelectorAll("video").forEach(b=>{b.muted=!0})};a.unmuteAllVideos=function(){this.getElementById(this.currentSceneId()).querySelectorAll("video").forEach(b=>{b.muted=!1})}}});window.HYPE_eventListeners.push({type:"HypeScenePrepareForDisplay",callback:function(a,c,d){u(a);v(a)}});window.HYPE_eventListeners.push({type:"HypeSceneLoad",
callback:function(a,c,d){c.querySelectorAll("video").forEach(b=>{b.removeAttribute("autoplay");b.autoplay=!1})}});window.HYPE_eventListeners.push({type:"HypeSceneUnload",callback:function(a,c,d){w(a)}});return{version:"1.1.0",setDefault:function(a,c){typeof a==="object"?Object.assign(g,a):g[a]=c},getDefault:function(a){return a?g[a]:{...g}}}}());
